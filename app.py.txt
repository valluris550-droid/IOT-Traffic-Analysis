import streamlit as st
import pandas as pd
import plotly.express as px

st.set_page_config(page_title="IoT Traffic Monitor", layout="wide")

@st.cache_data
def load_data():
    df = pd.read_csv('iot_network_traffic.csv')
    return df

df = load_data()

st.title("üåê IoT Network Traffic Anomaly Dashboard")

# Sidebar
st.sidebar.header("Filter Traffic")
device = st.sidebar.multiselect("Select Device:", options=df['device_type'].unique(), default=df['device_type'].unique())
proto = st.sidebar.multiselect("Select Protocol:", options=df['protocol'].unique(), default=df['protocol'].unique())

filtered_df = df[(df['device_type'].isin(device)) & (df['protocol'].isin(proto))]

# Metrics
m1, m2, m3 = st.columns(3)
m1.metric("Total Flows", len(filtered_df))
m2.metric("Avg Packet Length", f"{filtered_df['packet_length'].mean():.2f}")
m3.metric("Attack Percentage", f"{(len(filtered_df[filtered_df['label']=='Attack'])/len(filtered_df)*100):.1f}%")

# Charts
c1, c2 = st.columns(2)
with c1:
    fig1 = px.histogram(filtered_df, x="protocol", color="label", barmode="group", title="Traffic by Protocol & Label")
    st.plotly_chart(fig1, use_container_width=True)

with c2:
    fig2 = px.scatter(filtered_df, x="duration", y="packet_length", color="label", title="Duration vs Length")
    st.plotly_chart(fig2, use_container_width=True)